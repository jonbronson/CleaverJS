!function t(e,r,o){function i(n,h){if(!r[n]){if(!e[n]){var u="function"==typeof require&&require;if(!h&&u)return u(n,!0);if(s)return s(n,!0);var a=new Error("Cannot find module '"+n+"'");throw a.code="MODULE_NOT_FOUND",a}var c=r[n]={exports:{}};e[n][0].call(c.exports,function(t){var r=e[n][1][t];return i(r?r:t)},c,c.exports,t,e,r,o)}return r[n].exports}for(var s="function"==typeof require&&require,n=0;n<o.length;n++)i(o[n]);return i}({1:[function(t,e,r){var o={};o.CircleField=t("fields/circlefield"),o.CleaverMesher=t("cleavermesher"),o.ConstantField=t("fields/constantfield"),o.FloatField=t("fields/floatfield"),o.RectField=t("fields/rectfield"),o.GeomUtil=t("geometry/geomutil"),o.InverseField=t("fields/inversefield"),o.TransformedField=t("fields/transformedfield"),o.UnionField=t("fields/unionfield"),o.IntersectionField=t("fields/intersectionfield"),o.ScaledField=t("fields/scaledfield"),o.Mesh=t("geometry/mesh"),o.PathField=t("fields/pathfield"),o.Plane=t("geometry/plane"),o.Point=t("geometry/point"),o.QuadTree=t("quadtree.js"),o.QuadTreeMesher=t("quadtreemesher"),o.Rect=t("geometry/rect"),o.Vector=t("geometry/vector"),o.Matrix=t("matrix"),o.Vector3=t("geometry/vector3"),o.Vertex=t("geometry/vertex"),window.Cleaver=o},{cleavermesher:2,"fields/circlefield":3,"fields/constantfield":4,"fields/floatfield":6,"fields/intersectionfield":7,"fields/inversefield":8,"fields/pathfield":9,"fields/rectfield":10,"fields/scaledfield":11,"fields/transformedfield":12,"fields/unionfield":13,"geometry/geomutil":14,"geometry/mesh":16,"geometry/plane":17,"geometry/point":18,"geometry/rect":19,"geometry/vector":21,"geometry/vector3":22,"geometry/vertex":23,matrix:24,"quadtree.js":26,quadtreemesher:27}],2:[function(t,e,r){var o=t("./geometry/vector"),i=t("./geometry/vector3"),s=t("./geometry/vertex"),n=(t("./geometry/triangle"),t("./quadtree.js"),t("./quadtreemesher"),t("./geometry/rect"),t("./geometry/plane")),h=t("./geometry/geomutil");t("./fields/floatfield");e.exports=function(){"use strict";var t=0,e=1,r=2,u=3,a=4,c=5,l=6,f=1,p=[[l,t,u],[l,u,e],[l,e,a],[l,a,r],[l,r,c],[l,c,t]],d=[t,e,e,r,r,t],v=.3,y=function(t){this.alpha=t&&t[alpha]?t[alpha]:v};return y.prototype.setInputFields=function(t){this.fields=t},y.prototype.setInputMesh=function(t){this.mesh=t},y.prototype.materialAt_=function(t,e){for(var r=0,o=-1e5,i=0;i<this.fields.length;i++){var s=this.fields[i].valueAt(t,e);s>o&&(r=i,o=s)}return r},y.prototype.sampleFields=function(){for(var t=0;t<this.mesh.verts.length;t++){var e=this.materialAt_(this.mesh.verts[t].pos.x,this.mesh.verts[t].pos.y);this.mesh.verts[t].material=e}},y.prototype.computeCutForEdge_=function(t){var e=t.vertex,r=t.mate.vertex;if(t.evaluated=!0,t.mate.evaluated=!0,e.material!=r.material){var i=e.material,n=r.material,h=this.fields[i].valueAt(e.pos.x,e.pos.y),u=this.fields[i].valueAt(r.pos.x,r.pos.y),a=this.fields[n].valueAt(e.pos.x,e.pos.y),c=this.fields[n].valueAt(r.pos.x,r.pos.y),l=h-a,f=c-u+h-a,p=l/f;p=Math.max(p,0),p=Math.min(p,1);var d=e.pos.x*(1-p)+r.pos.x*p,v=e.pos.y*(1-p)+r.pos.y*p,y=new s(new o(d,v));return y.order_=1,t.cut=y,t.mate.cut=y,.5>p?y.closestGeometry=e:y.closestGeometry=r,p<=this.alpha||p>=1-this.alpha?y.violating=!0:y.violating=!1,y}},y.prototype.computeTripleForFace_=function(t){var e=t.v1,r=t.v2,u=t.v3;if(t.evaluated=!0,e.material!=r.material&&r.material!=u.material&&u.material!=e.material){var a=new i(e.pos.x,e.pos.y,this.fields[e.material].valueAt(e.pos.x,e.pos.y)),c=new i(r.pos.x,r.pos.y,this.fields[e.material].valueAt(r.pos.x,r.pos.y)),l=new i(u.pos.x,u.pos.y,this.fields[e.material].valueAt(u.pos.x,u.pos.y)),f=n.fromPoints(a,c,l),p=new i(e.pos.x,e.pos.y,this.fields[r.material].valueAt(e.pos.x,e.pos.y)),d=new i(r.pos.x,r.pos.y,this.fields[r.material].valueAt(r.pos.x,r.pos.y)),v=new i(u.pos.x,u.pos.y,this.fields[r.material].valueAt(u.pos.x,u.pos.y)),y=n.fromPoints(p,d,v),g=new i(e.pos.x,e.pos.y,this.fields[u.material].valueAt(e.pos.x,e.pos.y)),m=new i(r.pos.x,r.pos.y,this.fields[u.material].valueAt(r.pos.x,r.pos.y)),x=new i(u.pos.x,u.pos.y,this.fields[u.material].valueAt(u.pos.x,u.pos.y)),b=n.fromPoints(g,m,x),w=h.computePlaneIntersection(f,y,b),F=new s(new o(w.x,w.y));return F.order=2,t.triple=F,F}},y.prototype.computeCuts_=function(){var t=[];for(var e in this.mesh.halfEdges){var r=this.mesh.halfEdges[e];if(!r.evaluated){var o=this.computeCutForEdge_(r);o&&t.push(o)}}return t},y.prototype.computeTriples_=function(){var t=[];for(var e in this.mesh.faces){var r=this.mesh.faces[e];if(!r.evaluated){var o=this.computeTripleForFace_(r);o&&t.push(o)}}return[]},y.prototype.computeInterfaces=function(){this.cuts=this.computeCuts_(),this.triples=this.computeTriples_()},y.prototype.generalizeTriangles=function(){for(var t=0;t<this.mesh.faces.length;t++){var e=this.mesh.faces[t],r=e.halfEdges,o=0;if(e&&!e.triple){for(var i=0;3>i;i++)o+=e.halfEdges[i].cut&&1==e.halfEdges[i].cut.order()?1:0;for(var s,n=0,i=0;3>i;i++)r[i].cut?0==r[i].cut.order()&&(s=i,n++):(r[i].vertex.id<r[i].mate.vertex.id?r[i].cut=r[i].vertex:r[i].cut=r[i].mate.vertex,r[i].mate.cut=r[i].cut,s=i,n++);switch(n){case 0:throw new Error("Three cuts and no triple.");case 1:for(var h=0;3>h;h++)if(h!=s&&(r[h].vertex==r[s].cut||r[h].mate.vertex==r[s].cut)){e.triple=r[h].cut;break}break;case 2:throw new Error("Only one cut on triangle.");case 3:if(e.v1.id<e.v2.id&&e.v1.id<e.v3.id)e.triple=e.v1;else if(e.v2.id<e.v1.id&&e.v2.id<e.v3.id)e.triple=e.v2;else{if(!(e.v3.id<e.v1.id&&e.v3.id<e.v2.id))throw new Error("Problem finding minimum id");e.triple=e.v3}break;default:throw new Error("Impossible virtual cut count: "+n)}}}},y.prototype.snapAndWarpForVertex=function(t){for(var e=this.mesh.getEdgesAroundVertex(t),r=[],i=[],s=[],n=0;n<e.length;n++){var h=e[n];h.cut.order()==f&&(h.cut.violating&&h.cut.closestGeometry==t?r.push(h):i.push(h))}if(0!=r.length||0!=s.length){for(var u=o.ZERO(),a=0;a<r.length;a++)u.add(r[a].cut.pos);for(var a=0;a<s.length;a++)u.add(s[a].triple.pos);u.multiply(1/(r.length+s.length)),t.pos=u,t.warped=!0;for(var n=0;n<i.length;n++)var h=i[n];for(var n=0;n<r.length;n++)this.snapCutForEdgeToVertex_(r[n],t);for(var n=0;n<i.length;n++)this.snapCutForEdgeToVertex_(i[n],t)}},y.prototype.getInnerFace=function(t,e,r){var o=null;if(e===t.vertex)o=t.mate.vertex;else{if(e!==t.mate.vertex)throw new Error("warp Edge doesn't contain warp vertex.");o=t.vertex}for(var i=this.mesh.getFacesAroundEdge(t),s=[],n=0;n<i.length;n++)for(var u=0;3>u;u++){var t=i[n].halfEdges[u];t.vertex!==o&&t.mate.vertex!==o&&s.push(t)}if(s.length!=i.length)throw new Error("Failed to pair adjacent faces to their intersecting edges");for(var a=[],u=0;u<s.length;u++){var c,l,f,p,t=s[u];c=o.pos,l=r,f=e.pos,p=t.vertex===e?t.mate.vertex.pos:t.vertex.pos;var d=h.computeLineIntersection(c,l,f,p);a.push(d),console.log("intersection t="+d.ub)}for(var v=0,y=0,u=0;u<s.length;u++)a.ub>y&&(v=u,y=a.ub);return i[v]},y.prototype.snapCutForEdgeToVertex_=function(t,e){t.cut.order_==f?t.cut.parent=e:(console.log("shoudlnt be here"),t.cut=e,t.mate.cut=e)},y.prototype.snapAndWarpVertexViolations_=function(){for(var t=0;t<this.mesh.verts.length;t++){var e=this.mesh.verts[t];this.snapAndWarpForVertex(e)}},y.prototype.snapAndWarpEdgeViolations_=function(){},y.prototype.snapAndWarpViolations=function(){this.snapAndWarpVertexViolations_(),this.snapAndWarpEdgeViolations_()},y.prototype.createStencilTriangles=function(){for(var t=0,e=this.mesh.faces.length,r=0;e>r;r++){for(var o=this.mesh.faces[r],i=0,s=0;3>s;s++)i+=1==o.halfEdges[s].cut.order()?1:0;for(var n=[o.v1,o.v2,o.v3,o.halfEdges[0].cut,o.halfEdges[1].cut,o.halfEdges[2].cut,o.triple],h=0;6>h;h++){var u=n[p[h][0]].root(),a=n[p[h][1]].root(),c=n[p[h][2]].root(),l=n[d[h]].root();u!=a&&u!=c&&a!=c&&(this.mesh.createFace(u,a,c,l.material),t++)}}console.log("Input mesh has "+e+" triangles."),console.log("Total of "+t+" new triangles created")},y.prototype.cleave=function(){this.sampleFields(),this.computeInterfaces(),this.generalizeTriangles(),this.snapAndWarpViolations(),this.createStencilTriangles()},y}()},{"./fields/floatfield":6,"./geometry/geomutil":14,"./geometry/plane":17,"./geometry/rect":19,"./geometry/triangle":20,"./geometry/vector":21,"./geometry/vector3":22,"./geometry/vertex":23,"./quadtree.js":26,"./quadtreemesher":27}],3:[function(t,e,r){var o=t("../geometry/point");e.exports=function(){"use strict";var t=function(t,e,r,i){this.c=new o(t,e),this.r=r,this.bounds=i};return t.prototype.valueAt=function(t,e){var r=new o(t,e),i=this.r-Math.abs(this.c.minus(r).length());return i},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{"../geometry/point":18}],4:[function(t,e,r){e.exports=function(){"use strict";var t=function(t,e){this.value=t,this.bounds=e};return t.prototype.valueAt=function(t,e){return this.value},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.size.x},t.prototype.getHeight=function(){return this.bounds.size.y},t}()},{}],5:[function(t,e,r){e.exports=function(){"use strict";var t=function(){};return t.prototype.valueAt=function(t,e){},t.prototype.getBounds=function(){},t.prototype.getWidth=function(){},t.prototype.getHeight=function(){},t}()},{}],6:[function(t,e,r){var o=t("./field"),i=t("../geometry/rect");e.exports=function(){"use strict";var t=function(t,e,r){this.data=r,this.bounds=new i(0,0,t,e)};t.prototype=Object.create(o.prototype),t.prototype.nearestValueAt=function(t,e){var r=Math.round(t),o=Math.round(e);return this.data[o*this.bounds.size.x+r]};var e=function(t,e,r){return Math.min(Math.max(t,e),r)};return t.prototype.valueAt=function(t,r){t-=.5,r-=.5;var o=t%1,i=r%1,s=Math.floor(t),n=s+1,h=Math.floor(r),u=h+1;s=e(s,0,this.bounds.width()-1),n=e(n,0,this.bounds.width()-1),h=e(h,0,this.bounds.height()-1),u=e(u,0,this.bounds.height()-1);var a=this.data[s+h*this.bounds.width()],c=this.data[s+u*this.bounds.width()],l=this.data[n+h*this.bounds.width()],f=this.data[n+u*this.bounds.width()];return(1-o)*(1-i)*a+(1-o)*i*c+o*(1-i)*l+o*i*f},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{"../geometry/rect":19,"./field":5}],7:[function(t,e,r){e.exports=function(){"use strict";var t=function(t,e){this.fields=t,this.bounds=e};return t.prototype.valueAt=function(t,e){for(var r=this.fields[0].valueAt(t,e),o=1;o<this.fields.length;o++)r=Math.min(r,this.fields[o].valueAt(t,e));return r},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{}],8:[function(t,e,r){e.exports=function(){"use strict";var t=function(t){this.field=t,this.bounds=t.bounds};return t.prototype.valueAt=function(t,e){return-1*this.field.valueAt(t,e)},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.size.x},t.prototype.getHeight=function(){return this.bounds.size.y},t}()},{}],9:[function(t,e,r){var o=t("geometry/vector"),i=t("geometry/point"),s=t("geometry/geomutil");e.exports=function(){"use strict";var t=function(t,e,r,o,i){this.points=t,this.order=e,this.closed=r,this.strokeWidth=o,this.bounds=i};t.prototype.valueAt=function(t,e){for(var o=new i(t,e),s=r(this.points[0],this.points[1],o),n=s,h=this.closed?this.points.length:this.points.length-1,u=1;h>u;u++)s=r(this.points[u],this.points[(u+1)%this.points.length],o),n>s&&(n=s);return n-=this.strokeWidth,n=1==this.isPointInsidePath(o)?Math.abs(n):-1*Math.abs(n)},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.size.x},t.prototype.getHeight=function(){return this.bounds.size.y};var e=function(t,e,r){return e>t?e:t>r?r:t},r=function(t,r,i){var s=i.minus(t),n=r.minus(t),h=new o(n.x,n.y).normalize(),u=s.dot(h);u=e(u,0,n.length());var a=t.plus(n.multiply(u/n.length())),c=i.minus(a).length();return c};return t.prototype.isPointInsidePath=function(t){for(var e=0,r=0;r<this.points.length;r++){var o=new i(.001,.1),n=t,h=this.points[r],u=this.points[(r+1)%this.points.length],a=s.computeLineIntersection(o,n,h,u);a.ua>=-1e-7&&a.ua<=1.00000001&&a.ub>=-1e-7&&a.ub<=1.00000001&&e++}return e%2==0?!1:!0},t}()},{"geometry/geomutil":14,"geometry/point":18,"geometry/vector":21}],10:[function(t,e,r){var o=t("../geometry/point"),i=t("../fields/pathfield");e.exports=function(){"use strict";var t=function(t,e,r,s,n){var h=[new o(t.left,t.bottom),new o(t.right,t.bottom),new o(t.right,t.top),new o(t.left,t.top)];i.call(this,h,e,r,s,n)};return t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t}()},{"../fields/pathfield":9,"../geometry/point":18}],11:[function(t,e,r){t("../geometry/vector");e.exports=function(){"use strict";var t=function(t,e,r){this.field=t,this.scale=e,this.bounds=r};return t.prototype.valueAt=function(t,e){return this.scale*this.field.valueAt(t,e)},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{"../geometry/vector":21}],12:[function(t,e,r){var o=t("../geometry/vector");e.exports=function(){"use strict";var t=function(t,e,r){this.field=t,this.transform=e,this.inverseTransform=e.inverse(),this.bounds=r};return t.prototype.valueAt=function(t,e){var r=this.inverseTransform.multiplyVector(new o(t,e));return this.field.valueAt(r.x,r.y)},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.size.x},t.prototype.getHeight=function(){return this.bounds.size.y},t}()},{"../geometry/vector":21}],13:[function(t,e,r){e.exports=function(){"use strict";var t=function(t,e){this.fields=t,this.bounds=e};return t.prototype.valueAt=function(t,e){for(var r=this.fields[0].valueAt(t,e),o=1;o<this.fields.length;o++)r=Math.max(r,this.fields[o].valueAt(t,e));return r},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{}],14:[function(t,e,r){var o=(t("./point"),t("./vector")),i=t("./vector3");e.exports=function(){"use strict";var t={computeLineIntersection:function(t,e,r,o){var i=(o.x-r.x)*(t.y-r.y)-(o.y-r.y)*(t.x-r.x),s=(o.y-r.y)*(e.x-t.x)-(o.x-r.x)*(e.y-t.y),n=(e.x-t.x)*(t.y-r.y)-(e.y-t.y)*(t.x-r.x),h=(o.y-r.y)*(e.x-t.x)-(o.x-r.x)*(e.y-t.y),u=i/s,a=n/h;return{ua:u,ub:a}},computePlaneIntersection:function(t,e,r){var o=t.getNormal(),s=e.getNormal(),n=r.getNormal(),h=s.cross(n).multiply(t.d),u=n.cross(o).multiply(e.d),a=o.cross(s).multiply(r.d),c=1/i.dot(o,i.cross(s,n)),l=h.plus(u).plus(a).multiply(c);if(isNaN(l.x)||NaN==isNaN(l.y)||NaN==isNaN(l.z)){var f=new Error("failed to compute 3-plane intersection");console.log(f.stack())}return l},computeMeshAngles:function(t){for(var e=[],r=0;r<t.faces.length;r++)for(var i=t.faces[r],s=[i.v1.pos,i.v2.pos,i.v3.pos],n=0;3>n;n++){var h=s[(n+1)%3].minus(s[n]).normalize(),u=s[(n+2)%3].minus(s[n]).normalize(),a=Math.acos(o.dot(h,u));a*=180/Math.PI,e.push(a)}return e}};return t}()},{"./point":18,"./vector":21,"./vector3":22}],15:[function(t,e,r){t("./vertex");e.exports=function(){"use strict";var t=function(t){this.vertex=t,this.mate=null,this.cut=null,this.next=null};return t}()},{"./vertex":23}],16:[function(t,e,r){var o=t("./halfedge"),i=t("./triangle");t("./vertex");e.exports=function(){"use strict";var t=function(){this.verts=[],this.faces=[],this.halfEdges={}};return t.prototype.createFace=function(t,e,r,o){t&&e&&r||console.log("problem!");var s=new i(t,e,r,o);this.faces.push(s),void 0===t.id&&(t.id=this.verts.length,this.verts.push(t)),void 0===e.id&&(e.id=this.verts.length,this.verts.push(e)),void 0===r.id&&(r.id=this.verts.length,this.verts.push(r))},t.prototype.halfEdgeForVerts=function(t,e){var r=t.pos.toString()+"|"+e.pos.toString(),i=this.halfEdges[r];return i||(i=new o(e),t.halfEdges.push(i),this.halfEdges[r]=i),i},t.prototype.buildAdjacency=function(){this.halfEdges=[];for(var t=0;t<this.faces.length;t++){var e=this.faces[t].v1,r=this.faces[t].v2,o=this.faces[t].v3;this.faces[t].halfEdges[0]=this.halfEdgeForVerts(e,r),this.faces[t].halfEdges[1]=this.halfEdgeForVerts(r,o),this.faces[t].halfEdges[2]=this.halfEdgeForVerts(o,e);for(var i=0;3>i;i++)this.faces[t].halfEdges[i].face=this.faces[t];this.faces[t].halfEdges[0].mate=this.halfEdgeForVerts(r,e),this.faces[t].halfEdges[1].mate=this.halfEdgeForVerts(o,r),this.faces[t].halfEdges[2].mate=this.halfEdgeForVerts(e,o),this.faces[t].halfEdges[0].mate.mate=this.faces[t].halfEdges[0],this.faces[t].halfEdges[1].mate.mate=this.faces[t].halfEdges[1],this.faces[t].halfEdges[2].mate.mate=this.faces[t].halfEdges[2],this.faces[t].halfEdges[0].next=this.faces[t].halfEdges[1],this.faces[t].halfEdges[1].next=this.faces[t].halfEdges[2],this.faces[t].halfEdges[2].next=this.faces[t].halfEdges[0]}},t.prototype.getEdgesAroundVertex=function(t){return t.halfEdges},t.prototype.getFacesAroundVertex=function(t){return t.faces},t.prototype.getFacesAroundEdge=function(t){var e=[];if(t.face&&e.push(t.face),t.mate.face&&e.push(t.mate.face),0===e.length)throw new Error("Edge has no incident faces.");return e},t.prototype.getFaces=function(){return this.faces},t.prototype.getVerticesAroundFace=function(t){var e=[t.v1,t.v2,t.v3];return e},t.prototype.getEdgesAroundFace=function(t){var e=[t.halfEdges[0],t.halfEdges[1],t.halfEdges[2]];return e},t}()},{"./halfedge":15,"./triangle":20,"./vertex":23}],17:[function(t,e,r){var o=t("./vector3");e.exports=function(){"use strict";var t=function(t,e,r,o){this.a=t,this.b=e,this.c=r,this.d=o};return t.fromPoints=function(e,r,o){var i=r.minus(e).cross(o.minus(e)).normalize(),s=i.dot(e);return new t(i.x,i.y,i.z,s)},t.fromPointAndNormal=function(e,r){var o=-r.dot(e),i=new t(r.x,r.y,r.z,o);return i},t.prototype.getNormal=function(){return new o(this.a,this.b,this.c)},t}()},{"./vector3":22}],18:[function(t,e,r){var o=t("./vector");e.exports=function(){"use strict";var t=function(t,e){o.call(this,t,e)};return t.prototype=Object.create(o.prototype),t.prototype.constructor=t,t}()},{"./vector":21}],19:[function(t,e,r){var o=t("./point");e.exports=function(){"use strict";var t=function(t,e,r,o){this.left=t,this.bottom=e,this.right=r,this.top=o};return t.prototype.width=function(){return this.right-this.left},t.prototype.height=function(){return this.top-this.bottom},t.prototype.center=function(){return new o(.5*(this.left+this.right),.5*(this.top+this.bottom))},t.EMPTY=function(){return new t(0,0,0,0)},t.prototype.containsPoint=function(t){},t.prototype.containsRect=function(t){},t.prototype.strictlyContainsRect=function(t){},t.prototype.intersects=function(t){},t}()},{"./point":18}],20:[function(t,e,r){e.exports=function(){"use strict";var t=function(t,e,r,o){this.v1=t,this.v2=e,this.v3=r,this.material=o,t.faces||(t.faces=[]),e.faces||(e.faces=[]),r.faces||(r.faces=[]),t.faces.push(this),e.faces.push(this),r.faces.push(this),this.halfEdges=[]};return t.prototype.toSVG=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","path"),e=" M "+this.v1.pos.x+" "+this.v1.pos.y+" L "+this.v2.pos.x+" "+this.v2.pos.y+" L "+this.v3.pos.x+" "+this.v3.pos.y+" L "+this.v1.pos.x+" "+this.v1.pos.y;t.setAttribute("d",e),t.setAttribute("stroke-width","0.2");var r="black",o="#FFFFFF";switch(this.material){case 0:o="#cad7f2",r="#a0b0b0";break;case 1:o="#fed8bc",r="#b0b0a0";break;case 2:o="#bbFFbb",r="#007700";break;case 3:o="#bbbbFF",r="#000077";break;case 4:o="#fbb0cF",r="#bf0c3F";break;default:o="#ffffff",r="black"}return t.setAttribute("fill",o),t.setAttribute("stroke",r),t},t}()},{}],21:[function(t,e,r){e.exports=function(){"use strict";var t=function(t,e){this.x=t,this.y=e};return t.prototype.toString=function(){return"["+this.x+", "+this.y+"]"},t.prototype.createPerpendicular=function(){return new t(this.y,-1*this.x)},t.prototype.plus=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.minus=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.dot=function(e){return t.dot(this,e)},t.prototype.cross=function(e){return t.cross(this,e)},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,this},t.normalize=function(t){return t.normalize()},t.min=function(e,r){return new t(e.x<r.x?e.x:r.x,e.y<r.y?e.y:r.y)},t.max=function(e,r){return new t(e.x>r.x?e.x:r.x,e.y>r.y?e.y:r.y)},t.angleBetween=function(t,e){},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.cross=function(t,e){return t.x*e.y-t.y*e.x},t.ZERO=function(){return new t(0,0)},t.UNIT_X=function(){return new t(1,0)},t.UNIT_Y=function(){return new t(0,1)},t}()},{}],22:[function(t,e,r){e.exports=function(){"use strict";var t=function(t,e,r){this.x=t,this.y=e,this.z=r};return t.prototype.toString=function(){return"["+this.x+", "+this.y+", "+this.z+"]"},t.prototype.plus=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.minus=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.dot=function(e){return t.dot(this,e)},t.prototype.cross=function(e){return t.cross(this,e)},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,this.z/=t,this},t.normalize=function(t){return t.normalize()},t.min=function(e,r){return new t(e.x<r.x?e.x:r.x,e.y<r.y?e.y:r.y,e.z<r.z?e.z:r.z)},t.max=function(e,r){return new t(e.x>r.x?e.x:r.x,e.y>r.y?e.y:r.y,e.z>r.z?e.z:r.z)},t.angleBetween=function(t,e){},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.cross=function(e,r){return new t(e.y*r.z-e.z*r.y,e.z*r.x-e.x*r.z,e.x*r.y-e.y*r.x)},t.ZERO=function(){return new t(0,0,0)},t.UNIT_X=function(){return new t(1,0,0)},t.UNIT_Y=function(){return new t(0,1,0)},t.UNIT_Z=function(){return new t(0,0,1)},t}()},{}],23:[function(t,e,r){var o=t("./vector");e.exports=function(){"use strict";var t=function(t){this.pos=t?t:o.ZERO(),this.halfEdges=[],this.faces=[],this.parent=null,this.order_=0};return t.prototype=Object.create(o.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return"["+this.pos.x+", "+this.pos.y+"]"},t.prototype.order=function(){return this.root().order_},t.prototype.root=function(){for(var t=this;t.parent;)t=t.parent;return t},t.CreateAt=function(e,r){return new t(new o(e,r))},t}()},{"./vector":21}],24:[function(t,e,r){var o=t("geometry/vector"),i=t("geometry/vector3");e.exports=function(){"use strict";var t=function(e,r,o,i,s,n,h,u,a){if(void 0==e)var c=[[1,0,0],[0,1,0],[0,0,1]];else var c=[[e,r,o],[i,s,n],[h,u,a]];var l=Object.create(Array.prototype);return l=Array.apply(l,c)||l,t.injectClassMethods_(l),l};return t.injectClassMethods_=function(e){for(var r in t.prototype)t.prototype.hasOwnProperty(r)&&(e[r]=t.prototype[r]);return e},t.prototype.toString=function(){for(var t="[",e=0;3>e;e++){t+="[";for(var r=0;3>r;r++)t+=this[e][r],2>r&&(t+=",");t+="]",2>e&&(t+=", ")}return t+="]"},t.prototype.multiply=function(e){for(var r=new t(0,0,0,0,0,0,0,0,0),o=0;3>o;o++)for(var i=0;3>i;i++)for(var s=0;3>s;s++)r[o][i]+=this[o][s]*e[s][i];return r},t.prototype.multiplyVector=function(t){var e=new i(t.x,t.y,1),r=this.multiplyVector3(e);return new o(r.x/r.z,r.y/r.z)},t.prototype.multiplyVector3=function(t){var e=new i;return e.x=this[0][0]*t.x+this[0][1]*t.y+this[0][2]*t.z,e.y=this[1][0]*t.x+this[1][1]*t.y+this[1][2]*t.z,e.z=this[2][0]*t.x+this[2][1]*t.y+this[2][2]*t.z,e},t.prototype.inverse=function(){var e=new t,r=+this[0][0]*(this[1][1]*this[2][2]-this[2][1]*this[1][2])-this[0][1]*(this[1][0]*this[2][2]-this[1][2]*this[2][0])+this[0][2]*(this[1][0]*this[2][1]-this[1][1]*this[2][0]),o=1/r;return e[0][0]=(this[1][1]*this[2][2]-this[2][1]*this[1][2])*o,e[0][1]=-(this[0][1]*this[2][2]-this[0][2]*this[2][1])*o,e[0][2]=(this[0][1]*this[1][2]-this[0][2]*this[1][1])*o,e[1][0]=-(this[1][0]*this[2][2]-this[1][2]*this[2][0])*o,e[1][1]=(this[0][0]*this[2][2]-this[0][2]*this[2][0])*o,e[1][2]=-(this[0][0]*this[1][2]-this[1][0]*this[0][2])*o,e[2][0]=(this[1][0]*this[2][1]-this[2][0]*this[1][1])*o,e[2][1]=-(this[0][0]*this[2][1]-this[2][0]*this[0][1])*o,e[2][2]=(this[0][0]*this[1][1]-this[1][0]*this[0][1])*o,e},t.createRotation=function(e){var r=new t;return r[0][0]=Math.cos(e),r[0][1]=-Math.sin(e),r[1][0]=Math.sin(e),r[1][1]=Math.cos(e),r},t.createTranslation=function(e,r){var o=new t;return o[0][2]=e,o[1][2]=r,o},t.createScale=function(e,r){var o=new t;return o[0][0]=e,o[1][1]=r,o},t}()},{"geometry/vector":21,"geometry/vector3":22}],25:[function(t,e,r){var o=t("./geometry/rect");e.exports=function(){"use strict";var t=1,e=2,r=function(t){this.bounds=t,this.level=null,this.parent=null,this.children=[]};return r.prototype.hasChildren=function(){return this.children.length>0},r.prototype.subdivide=function(){if(0==this.level)return!1;for(var i=0;4>i;i++){var s=.5*this.bounds.width(),n=.5*this.bounds.height(),h=this.bounds.left+((i&t)>>0)*s,u=this.bounds.bottom+((i&e)>>1)*n,a=new o(h,u,h+s,u+n),c=new r(a);c.level=this.level-1,c.xLocCode=this.xLocCode|(i&t)>>0<<c.level,c.yLocCode=this.yLocCode|(i&e)>>1<<c.level,c.parent=this,this.children.push(c)}return!0},r.prototype.toSVG=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x",this.bounds.left),t.setAttribute("y",this.bounds.bottom),t.setAttribute("height",this.bounds.width()),t.setAttribute("width",this.bounds.height()),t.setAttribute("fill","none"),t.setAttribute("stroke","#0000bb"),t.setAttribute("stroke-width","0.1");var e=this;return t.onclick=function(){window.setCurrentCell(e)},t},r.prototype.splitSVG=function(t){this.subdivide();for(var e=t.parentElement,r=0;r<this.children.length;r++)this.children[r]&&e.appendChild(this.children[r].toSVG())},r}()},{"./geometry/rect":19}],26:[function(t,e,r){var o=t("./geometry/rect"),i=t("./quadcell");e.exports=function(){"use strict";var t=function(t,e){e?this.maxLevels=e:this.maxLevels=l,this.bounds=t,this.nLevels=this.maxLevels+1,this.rootLevel=this.maxLevels,this.maxVal=r(this.rootLevel),this.maxCode=this.maxVal-1,this.root=new i(t),this.root.xLocCode=0,this.root.yLocCode=0,this.root.level=this.rootLevel};t.prototype.getRoot=function(){return this.root},t.prototype.getCell=function(t,e){if(0>t||0>e)return null;if(t>this.maxCode||e>this.maxCode)return null;for(var r=this.root,o=this.rootLevel-1;r&&r.level>0;){var i=1<<o,s=((t&i)>>o<<0)+((e&i)>>o<<1);--o;var n=r.children[s];if(void 0===n)return r;if(n.xLocCode==t&&n.yLocCode==e)return n;r=n}return r},t.prototype.getNeighbor=function(t,e){var r=1<<t.level,o=t.xLocCode+a[e][0]*r,i=t.yLocCode+a[e][1]*r;return this.getCell(o,i)},t.prototype.getNeighborAtLevel=function(t,e,r,o){var i=1<<t.level,s=t.xLocCode+a[e][0]*i,n=t.yLocCode+a[e][1]*i;if(0>s||0>n)return null;if(s>=this.maxCode||n>=this.maxCode)return null;for(var t=this.getRoot(),h=t.level-1;t&&t.level>r;){var u=1<<h,c=((s&u)>>h)+((n&u)>>h<<1);if(--h,t.hasChildren())t=t.children[c];else{if(o)break;t=null}}return t},t.prototype.addCellAtDepth=function(t,e,r){for(var o,i,s=Math.round(t-.5),n=Math.round(e-.5),h=this.root,u=this.rootLevel-1,a=u+1;a--&&h.level>0;)o=1<<u,i=((s&o)>>u)+((n&o)>>u<<1),--u,h.hasChildren()||(console.log("subdividing"),h.subdivide()),h=h.children[i];return h},t.prototype.balance=function(){var t=[],e=[];for(t.push(this.root);t.length>0;){var r=t.shift();if(0===r.xLocCode&&24===r.yLocCode&&console.log("examining target cell"),r.hasChildren())for(var o=0;4>o;o++)t.push(r.children[o]);else 0===r.xLocCode&&24===r.yLocCode&&console.log("pushing target cell onto stack at "+e.length),e.push(r)}for(;e.length>0;){var r=e.pop();0===r.xLocCode&&24===r.yLocCode&&console.log("at the problem cell");for(var o=0;4>o;o++){var i=this.getNeighborAtLevel(r,o,r.level);if(i&&i.hasChildren()){var s=[i.children[c[o][0]],i.children[c[o][1]]];if(s[0].hasChildren()||s[1].hasChildren()){r.subdivide();break}}}if(r.hasChildren())for(var o=0;4>o;o++)e.push(r.children[o])}},t.prototype.toSVG=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","g"),e=[];for(e.push(this.root);e.length>0;){var r=e.shift();t.appendChild(r.toSVG());for(var o=0;o<r.children.length;o++)r.children[o]&&e.push(r.children[o])}return t};var e=function(t,e,r){for(var o=0,i=t[o].valueAt(e,r),s=0;s<t.length;s++){var n=t[s].valueAt(e,r);n>i&&(i=n,o=s)}return o};t.createFromCSGFields=function(r,i){if(!r||r.length<1)throw new Error("Must provide at least two input fields");for(var s=r[0].getBounds(),n=new t(s,i),h=0;h<s.height();h++)for(var u=0;u<s.width();u++){var a=new o(u,h,u+1,h+1),c=e(r,a.left,a.bottom),l=e(r,a.left+1,a.bottom),f=e(r,a.left+1,a.bottom+1),p=e(r,a.left,a.bottom+1);if(c!=l||l!=f||f!=p||p!=c||p!=l||c!=f){var d=a.left/s.width()*n.maxVal,v=a.bottom/s.height()*n.maxVal;n.addCellAtDepth(d,v,i)}}return n},t.createFromFloatFields=function(i){if(!i||i.length<1)throw new Error("Must provide at least two input fields");for(var s=i[0].getBounds(),n=0,h=0;n<Math.max(s.width(),s.height());)n=r(++h);console.log("requires no more than "+h+" levels to achieve "+n+" res");for(var u=new t(s,h),a=0;a<s.height();a++)for(var c=0;c<s.width();c++){var l=new o(c,a,c+1,a+1),f=e(i,l.left,l.bottom),p=e(i,l.left+1,l.bottom),d=e(i,l.left+1,l.bottom+1),v=e(i,l.left,l.bottom+1);(f!=p||p!=d||d!=v||v!=f||v!=p||f!=d)&&(console.log("adding cell at ("+c+", "+a+")"),u.addCellAtDepth(l.left,l.bottom,h))}return u},t.createFromSizingField=function(e){var r=new t(e.getBounds()),o=[];for(o.push(r.getRoot());o.length>0;){var i=o.shift(),s=i.bounds.left+.5*i.bounds.width(),n=i.bounds.bottom+.5*i.bounds.height();if(i.bounds.size.x>.5*e.valueAt(s,n)&&i.subdivide())for(var h=0;4>h;h++)o.push(i.children[h])}return r};var r=function(t){switch(t){case-20:return 9.53674e-7;case-19:return 190735e-11;case-18:return 38147e-10;case-17:return 762939e-11;case-16:return 152588e-10;case-15:return 305176e-10;case-14:return 610352e-10;case-13:return.0001220703125;case-12:return.000244140625;case-11:return.00048828125;case-10:return.0009765625;case-9:return.001953125;case-8:return.00390625;case-7:return.0078125;case-6:return.015625;case-5:return.03125;case-4:return.0625;case-3:return.125;case-2:return.25;case-1:return.5;case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 8;case 4:return 16;case 5:return 32;case 6:return 64;case 7:return 128;case 8:return 256;case 9:return 512;case 10:return 1024;case 11:return 2048;case 12:return 4096;case 13:return 8192;case 14:return 16384;case 15:return 32768;case 16:return 65536;case 17:return 131072;case 18:return 262144;case 19:return 524288;case 20:return 1048576;default:var e=1;if(Math.abs(t)==t)for(var r=0;r<Math.abs(t);r++)e*=2;else for(var r=0;r<Math.abs(t);r++)e/=2;return e}},s=0,n=1,h=2,u=3,a=[[-1,0],[1,0],[0,-1],[0,1]],c=[[n,u],[s,h],[h,u],[s,n]],l=8;return t}()},{"./geometry/rect":19,"./quadcell":25}],27:[function(t,e,r){var o=(t("./quadtree"),t("./geometry/triangle"),t("./geometry/vertex")),i=t("./geometry/vector"),s=t("./geometry/mesh");e.exports=function(){"use strict";var t=[[3,0],[1,2],[0,1],[2,3]],e=function(t){this.tree=t,this.vertexMap={}};return e.prototype.vertexForPosition_=function(t,e){var r=this.vertexMap[t.toString()];return void 0!==r||e||(r=new o(t),this.vertexMap[t.toString()]=r),r},e.prototype.createVertices_=function(){var t=[];for(t.push(tree.getRoot());t.length>0;){var e=t.shift();if(e.hasChildren())for(var r=0;4>r;r++)t.push(e.children[r]);else{
e.bounds;this.vertexForPosition_(new i(e.bounds.left,e.bounds.bottom)),this.vertexForPosition_(new i(e.bounds.left+e.bounds.width(),e.bounds.bottom)),this.vertexForPosition_(new i(e.bounds.left+e.bounds.width(),e.bounds.bottom+e.bounds.height())),this.vertexForPosition_(new i(e.bounds.left,e.bounds.bottom+e.bounds.height())),this.vertexForPosition_(new i(e.bounds.left+.5*e.bounds.width(),e.bounds.bottom+.5*e.bounds.height()))}}},e.prototype.createTriangles_=function(){var e=[];for(e.push(tree.getRoot());e.length>0;){var r=e.shift();if(r.hasChildren())for(var o=0;4>o;o++)e.push(r.children[o]);else{var s=(r.bounds,[]);s.push(this.vertexForPosition_(new i(r.bounds.left,r.bounds.bottom))),s.push(this.vertexForPosition_(new i(r.bounds.left+r.bounds.width(),r.bounds.bottom))),s.push(this.vertexForPosition_(new i(r.bounds.left+r.bounds.width(),r.bounds.bottom+r.bounds.height()))),s.push(this.vertexForPosition_(new i(r.bounds.left,r.bounds.bottom+r.bounds.height())));for(var n=this.vertexForPosition_(new i(r.bounds.left+.5*r.bounds.width(),r.bounds.bottom+.5*r.bounds.height())),h=[],u=0;4>u;u++)h[u]=this.tree.getNeighborAtLevel(r,u,r.level);for(var u=0;4>u;u++){var a=this.vertexForPosition_(new i(.5*(s[t[u][0]].pos.x+s[t[u][1]].pos.x),.5*(s[t[u][0]].pos.y+s[t[u][1]].pos.y)),!0);a?(this.mesh.createFace(s[t[u][0]],a,n,3),this.mesh.createFace(s[t[u][1]],a,n,3)):this.mesh.createFace(s[t[u][0]],s[t[u][1]],n,1)}}}},e.prototype.setQuadTree=function(t){this.tree=t},e.prototype.createMesh=function(){if(!this.tree)throw new Error("no quad tree provided");this.mesh=new s;var t=[];for(t.push(tree.getRoot());t.length>0;){var e=t.shift();if(e.hasChildren())for(var r=0;4>r;r++)t.push(e.children[r]);else this.meshCell_(e)}return this.mesh},e.prototype.meshCell_=function(e){var r=(e.bounds,[]);r.push(this.vertexForPosition_(new i(e.bounds.left,e.bounds.bottom))),r.push(this.vertexForPosition_(new i(e.bounds.left+e.bounds.width(),e.bounds.bottom))),r.push(this.vertexForPosition_(new i(e.bounds.left+e.bounds.width(),e.bounds.bottom+e.bounds.height()))),r.push(this.vertexForPosition_(new i(e.bounds.left,e.bounds.bottom+e.bounds.height())));for(var o=this.vertexForPosition_(new i(e.bounds.left+.5*e.bounds.width(),e.bounds.bottom+.5*e.bounds.height())),s=[],n=0;4>n;n++)if(s[n]=this.tree.getNeighborAtLevel(e,n,e.level,!0),null==s[n])this.mesh.createFace(r[t[n][0]],r[t[n][1]],o,1);else if(s[n].level!==e.level||s[n].hasChildren()){if(s[n].level===e.level+1)this.mesh.createFace(r[t[n][0]],r[t[n][1]],o,2);else if(s[n].level===e.level&&s[n].hasChildren()){var h=this.vertexForPosition_(new i(.5*(r[t[n][0]].pos.x+r[t[n][1]].pos.x),.5*(r[t[n][0]].pos.y+r[t[n][1]].pos.y)));this.mesh.createFace(r[t[n][0]],h,o,3),this.mesh.createFace(r[t[n][1]],o,h,3)}}else this.mesh.createFace(r[t[n][0]],r[t[n][1]],o,2)},e}()},{"./geometry/mesh":16,"./geometry/triangle":20,"./geometry/vector":21,"./geometry/vertex":23,"./quadtree":26}]},{},[1]);