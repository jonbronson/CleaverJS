!function t(e,o,r){function i(n,h){if(!o[n]){if(!e[n]){var u="function"==typeof require&&require;if(!h&&u)return u(n,!0);if(s)return s(n,!0);var a=new Error("Cannot find module '"+n+"'");throw a.code="MODULE_NOT_FOUND",a}var l=o[n]={exports:{}};e[n][0].call(l.exports,function(t){var o=e[n][1][t];return i(o?o:t)},l,l.exports,t,e,o,r)}return o[n].exports}for(var s="function"==typeof require&&require,n=0;n<r.length;n++)i(r[n]);return i}({1:[function(t,e,o){var r={};r.CircleField=t("fields/circlefield"),r.CleaverMesher=t("cleavermesher"),r.ConstantField=t("fields/constantfield"),r.FloatField=t("fields/floatfield"),r.RectField=t("fields/rectfield"),r.GeomUtil=t("geometry/geomutil"),r.InverseField=t("fields/inversefield"),r.TransformedField=t("fields/transformedfield"),r.UnionField=t("fields/unionfield"),r.IntersectionField=t("fields/intersectionfield"),r.ScaledField=t("fields/scaledfield"),r.Mesh=t("geometry/mesh"),r.PathField=t("fields/pathfield"),r.Plane=t("geometry/plane"),r.Point=t("geometry/point"),r.QuadTree=t("quadtree.js"),r.QuadTreeMesher=t("quadtreemesher"),r.Rect=t("geometry/rect"),r.Vector=t("geometry/vector"),r.Matrix=t("matrix"),r.Vector3=t("geometry/vector3"),r.Vertex=t("geometry/vertex")},{cleavermesher:2,"fields/circlefield":3,"fields/constantfield":4,"fields/floatfield":6,"fields/intersectionfield":7,"fields/inversefield":8,"fields/pathfield":9,"fields/rectfield":10,"fields/scaledfield":11,"fields/transformedfield":12,"fields/unionfield":13,"geometry/geomutil":14,"geometry/mesh":16,"geometry/plane":17,"geometry/point":18,"geometry/rect":19,"geometry/vector":21,"geometry/vector3":22,"geometry/vertex":23,matrix:24,"quadtree.js":26,quadtreemesher:27}],2:[function(t,e,o){var r=t("./geometry/vector"),i=t("./geometry/vector3"),s=t("./geometry/vertex"),n=(t("./geometry/triangle"),t("./quadtree.js"),t("./quadtreemesher"),t("./geometry/rect"),t("./geometry/plane")),h=t("./geometry/geomutil");t("./fields/floatfield");e.exports=function(){"use strict";var t=0,e=1,o=2,u=3,a=4,l=5,c=6,f=1,p=[[c,t,u],[c,u,e],[c,e,a],[c,a,o],[c,o,l],[c,l,t]],d=[t,e,e,o,o,t],v=.3,y=function(t){this.alpha=t&&t[alpha]?t[alpha]:v};return y.prototype.setInputFields=function(t){this.fields=t},y.prototype.setInputMesh=function(t){this.mesh=t},y.prototype.materialAt_=function(t,e){for(var o=0,r=-1e5,i=0;i<this.fields.length;i++){var s=this.fields[i].valueAt(t,e);s>r&&(o=i,r=s)}return o},y.prototype.sampleFields=function(){for(var t=0;t<this.mesh.verts.length;t++){var e=this.materialAt_(this.mesh.verts[t].pos.x,this.mesh.verts[t].pos.y);this.mesh.verts[t].material=e}},y.prototype.computeCutForEdge_=function(t){var e=t.vertex,o=t.mate.vertex;if(t.evaluated=!0,t.mate.evaluated=!0,e.material!=o.material){var i=e.material,n=o.material,h=this.fields[i].valueAt(e.pos.x,e.pos.y),u=this.fields[i].valueAt(o.pos.x,o.pos.y),a=this.fields[n].valueAt(e.pos.x,e.pos.y),l=this.fields[n].valueAt(o.pos.x,o.pos.y),c=h-a,f=l-u+h-a,p=c/f;p=Math.max(p,0),p=Math.min(p,1);var d=e.pos.x*(1-p)+o.pos.x*p,v=e.pos.y*(1-p)+o.pos.y*p,y=new s(new r(d,v));return y.order_=1,t.cut=y,t.mate.cut=y,.5>p?y.closestGeometry=e:y.closestGeometry=o,p<=this.alpha||p>=1-this.alpha?y.violating=!0:y.violating=!1,y}},y.prototype.computeTripleForFace_=function(t){var e=t.v1,o=t.v2,u=t.v3;if(t.evaluated=!0,e.material!=o.material&&o.material!=u.material&&u.material!=e.material){var a=new i(e.pos.x,e.pos.y,this.fields[e.material].valueAt(e.pos.x,e.pos.y)),l=new i(o.pos.x,o.pos.y,this.fields[e.material].valueAt(o.pos.x,o.pos.y)),c=new i(u.pos.x,u.pos.y,this.fields[e.material].valueAt(u.pos.x,u.pos.y)),f=n.fromPoints(a,l,c),p=new i(e.pos.x,e.pos.y,this.fields[o.material].valueAt(e.pos.x,e.pos.y)),d=new i(o.pos.x,o.pos.y,this.fields[o.material].valueAt(o.pos.x,o.pos.y)),v=new i(u.pos.x,u.pos.y,this.fields[o.material].valueAt(u.pos.x,u.pos.y)),y=n.fromPoints(p,d,v),g=new i(e.pos.x,e.pos.y,this.fields[u.material].valueAt(e.pos.x,e.pos.y)),m=new i(o.pos.x,o.pos.y,this.fields[u.material].valueAt(o.pos.x,o.pos.y)),x=new i(u.pos.x,u.pos.y,this.fields[u.material].valueAt(u.pos.x,u.pos.y)),b=n.fromPoints(g,m,x),w=h.computePlaneIntersection(f,y,b),F=new s(new r(w.x,w.y));return F.order=2,t.triple=F,F}},y.prototype.computeCuts_=function(){var t=[];for(var e in this.mesh.halfEdges){var o=this.mesh.halfEdges[e];if(!o.evaluated){var r=this.computeCutForEdge_(o);r&&t.push(r)}}return t},y.prototype.computeTriples_=function(){var t=[];for(var e in this.mesh.faces){var o=this.mesh.faces[e];if(!o.evaluated){var r=this.computeTripleForFace_(o);r&&t.push(r)}}return[]},y.prototype.computeInterfaces=function(){this.cuts=this.computeCuts_(),this.triples=this.computeTriples_()},y.prototype.generalizeTriangles=function(){for(var t=0;t<this.mesh.faces.length;t++){var e=this.mesh.faces[t],o=e.halfEdges,r=0;if(e&&!e.triple){for(var i=0;3>i;i++)r+=e.halfEdges[i].cut&&1==e.halfEdges[i].cut.order()?1:0;for(var s,n=0,i=0;3>i;i++)o[i].cut?0==o[i].cut.order()&&(s=i,n++):(o[i].vertex.id<o[i].mate.vertex.id?o[i].cut=o[i].vertex:o[i].cut=o[i].mate.vertex,o[i].mate.cut=o[i].cut,s=i,n++);switch(n){case 0:throw new Error("Three cuts and no triple.");case 1:for(var h=0;3>h;h++)if(h!=s&&(o[h].vertex==o[s].cut||o[h].mate.vertex==o[s].cut)){e.triple=o[h].cut;break}break;case 2:throw new Error("Only one cut on triangle.");case 3:if(e.v1.id<e.v2.id&&e.v1.id<e.v3.id)e.triple=e.v1;else if(e.v2.id<e.v1.id&&e.v2.id<e.v3.id)e.triple=e.v2;else{if(!(e.v3.id<e.v1.id&&e.v3.id<e.v2.id))throw new Error("Problem finding minimum id");e.triple=e.v3}break;default:throw new Error("Impossible virtual cut count: "+n)}}}},y.prototype.snapAndWarpForVertex=function(t){for(var e=this.mesh.getEdgesAroundVertex(t),o=[],i=[],s=[],n=0;n<e.length;n++){var h=e[n];h.cut.order()==f&&(h.cut.violating&&h.cut.closestGeometry==t?o.push(h):i.push(h))}if(0!=o.length||0!=s.length){for(var u=r.ZERO(),a=0;a<o.length;a++)u.add(o[a].cut.pos);for(var a=0;a<s.length;a++)u.add(s[a].triple.pos);u.multiply(1/(o.length+s.length)),t.pos=u,t.warped=!0;for(var n=0;n<i.length;n++)var h=i[n];for(var n=0;n<o.length;n++)this.snapCutForEdgeToVertex_(o[n],t);for(var n=0;n<i.length;n++)this.snapCutForEdgeToVertex_(i[n],t)}},y.prototype.getInnerFace=function(t,e,o){var r=null;if(e===t.vertex)r=t.mate.vertex;else{if(e!==t.mate.vertex)throw new Error("warp Edge doesn't contain warp vertex.");r=t.vertex}for(var i=this.mesh.getFacesAroundEdge(t),s=[],n=0;n<i.length;n++)for(var u=0;3>u;u++){var t=i[n].halfEdges[u];t.vertex!==r&&t.mate.vertex!==r&&s.push(t)}if(s.length!=i.length)throw new Error("Failed to pair adjacent faces to their intersecting edges");for(var a=[],u=0;u<s.length;u++){var l,c,f,p,t=s[u];l=r.pos,c=o,f=e.pos,p=t.vertex===e?t.mate.vertex.pos:t.vertex.pos;var d=h.computeLineIntersection(l,c,f,p);a.push(d),console.log("intersection t="+d.ub)}for(var v=0,y=0,u=0;u<s.length;u++)a.ub>y&&(v=u,y=a.ub);return i[v]},y.prototype.snapCutForEdgeToVertex_=function(t,e){t.cut.order_==f?t.cut.parent=e:(console.log("shoudlnt be here"),t.cut=e,t.mate.cut=e)},y.prototype.snapAndWarpVertexViolations_=function(){for(var t=0;t<this.mesh.verts.length;t++){var e=this.mesh.verts[t];this.snapAndWarpForVertex(e)}},y.prototype.snapAndWarpEdgeViolations_=function(){},y.prototype.snapAndWarpViolations=function(){this.snapAndWarpVertexViolations_(),this.snapAndWarpEdgeViolations_()},y.prototype.createStencilTriangles=function(){for(var t=0,e=this.mesh.faces.length,o=0;e>o;o++){for(var r=this.mesh.faces[o],i=0,s=0;3>s;s++)i+=1==r.halfEdges[s].cut.order()?1:0;for(var n=[r.v1,r.v2,r.v3,r.halfEdges[0].cut,r.halfEdges[1].cut,r.halfEdges[2].cut,r.triple],h=0;6>h;h++){var u=n[p[h][0]].root(),a=n[p[h][1]].root(),l=n[p[h][2]].root(),c=n[d[h]].root();u!=a&&u!=l&&a!=l&&(this.mesh.createFace(u,a,l,c.material),t++)}}console.log("Input mesh has "+e+" triangles."),console.log("Total of "+t+" new triangles created")},y.prototype.cleave=function(){this.sampleFields(),this.computeInterfaces(),this.generalizeTriangles(),this.createStencilTriangles()},y}()},{"./fields/floatfield":6,"./geometry/geomutil":14,"./geometry/plane":17,"./geometry/rect":19,"./geometry/triangle":20,"./geometry/vector":21,"./geometry/vector3":22,"./geometry/vertex":23,"./quadtree.js":26,"./quadtreemesher":27}],3:[function(t,e,o){var r=t("../geometry/point");e.exports=function(){"use strict";var t=function(t,e,o,i){this.c=new r(t,e),this.r=o,this.bounds=i};return t.prototype.valueAt=function(t,e){var o=new r(t,e),i=this.r-Math.abs(this.c.minus(o).length());return i},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{"../geometry/point":18}],4:[function(t,e,o){e.exports=function(){"use strict";var t=function(t,e){this.value=t,this.bounds=e};return t.prototype.valueAt=function(t,e){return this.value},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.size.x},t.prototype.getHeight=function(){return this.bounds.size.y},t}()},{}],5:[function(t,e,o){e.exports=function(){"use strict";var t=function(){};return t.prototype.valueAt=function(t,e){},t.prototype.getBounds=function(){},t.prototype.getWidth=function(){},t.prototype.getHeight=function(){},t}()},{}],6:[function(t,e,o){var r=t("./field"),i=t("../geometry/rect");e.exports=function(){"use strict";var t=function(t,e,o){this.data=o,this.bounds=new i(0,0,t,e)};t.prototype=Object.create(r.prototype),t.prototype.nearestValueAt=function(t,e){var o=Math.round(t),r=Math.round(e);return this.data[r*this.bounds.size.x+o]};var e=function(t,e,o){return Math.min(Math.max(t,e),o)};return t.prototype.valueAt=function(t,o){t-=.5,o-=.5;var r=t%1,i=o%1,s=Math.floor(t),n=s+1,h=Math.floor(o),u=h+1;s=e(s,0,this.bounds.width()-1),n=e(n,0,this.bounds.width()-1),h=e(h,0,this.bounds.height()-1),u=e(u,0,this.bounds.height()-1);var a=this.data[s+h*this.bounds.width()],l=this.data[s+u*this.bounds.width()],c=this.data[n+h*this.bounds.width()],f=this.data[n+u*this.bounds.width()];return(1-r)*(1-i)*a+(1-r)*i*l+r*(1-i)*c+r*i*f},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{"../geometry/rect":19,"./field":5}],7:[function(t,e,o){e.exports=function(){"use strict";var t=function(t,e){this.fields=t,this.bounds=e};return t.prototype.valueAt=function(t,e){for(var o=this.fields[0].valueAt(t,e),r=1;r<this.fields.length;r++)o=Math.min(o,this.fields[r].valueAt(t,e));return o},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{}],8:[function(t,e,o){e.exports=function(){"use strict";var t=function(t){this.field=t,this.bounds=t.bounds};return t.prototype.valueAt=function(t,e){return-1*this.field.valueAt(t,e)},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.size.x},t.prototype.getHeight=function(){return this.bounds.size.y},t}()},{}],9:[function(t,e,o){var r=t("geometry/vector"),i=t("geometry/point"),s=t("geometry/geomutil");e.exports=function(){"use strict";var t=function(t,e,o,r,i){this.points=t,this.order=e,this.closed=o,this.strokeWidth=r,this.bounds=i};t.prototype.valueAt=function(t,e){for(var r=new i(t,e),s=o(this.points[0],this.points[1],r),n=s,h=this.closed?this.points.length:this.points.length-1,u=1;h>u;u++)s=o(this.points[u],this.points[(u+1)%this.points.length],r),n>s&&(n=s);return n-=this.strokeWidth,n=1==this.isPointInsidePath(r)?Math.abs(n):-1*Math.abs(n)},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.size.x},t.prototype.getHeight=function(){return this.bounds.size.y};var e=function(t,e,o){return e>t?e:t>o?o:t},o=function(t,o,i){var s=i.minus(t),n=o.minus(t),h=new r(n.x,n.y).normalize(),u=s.dot(h);u=e(u,0,n.length());var a=t.plus(n.multiply(u/n.length())),l=i.minus(a).length();return l};return t.prototype.isPointInsidePath=function(t){for(var e=0,o=0;o<this.points.length;o++){var r=new i(.001,.1),n=t,h=this.points[o],u=this.points[(o+1)%this.points.length],a=s.computeLineIntersection(r,n,h,u);a.ua>=-1e-7&&a.ua<=1.00000001&&a.ub>=-1e-7&&a.ub<=1.00000001&&e++}return e%2==0?!1:!0},t}()},{"geometry/geomutil":14,"geometry/point":18,"geometry/vector":21}],10:[function(t,e,o){var r=t("../geometry/point"),i=t("../fields/pathfield");e.exports=function(){"use strict";var t=function(t,e,o,s,n){var h=[new r(t.left,t.bottom),new r(t.right,t.bottom),new r(t.right,t.top),new r(t.left,t.top)];i.call(this,h,e,o,s,n)};return t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t}()},{"../fields/pathfield":9,"../geometry/point":18}],11:[function(t,e,o){t("../geometry/vector");e.exports=function(){"use strict";var t=function(t,e,o){this.field=t,this.scale=e,this.bounds=o};return t.prototype.valueAt=function(t,e){return this.scale*this.field.valueAt(t,e)},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{"../geometry/vector":21}],12:[function(t,e,o){var r=t("../geometry/vector");e.exports=function(){"use strict";var t=function(t,e,o){this.field=t,this.transform=e,this.inverseTransform=e.inverse(),this.bounds=o};return t.prototype.valueAt=function(t,e){var o=this.inverseTransform.multiplyVector(new r(t,e));return this.field.valueAt(o.x,o.y)},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.size.x},t.prototype.getHeight=function(){return this.bounds.size.y},t}()},{"../geometry/vector":21}],13:[function(t,e,o){e.exports=function(){"use strict";var t=function(t,e){this.fields=t,this.bounds=e};return t.prototype.valueAt=function(t,e){for(var o=this.fields[0].valueAt(t,e),r=1;r<this.fields.length;r++)o=Math.max(o,this.fields[r].valueAt(t,e));return o},t.prototype.getBounds=function(){return this.bounds},t.prototype.getWidth=function(){return this.bounds.width()},t.prototype.getHeight=function(){return this.bounds.height()},t}()},{}],14:[function(t,e,o){var r=(t("./point"),t("./vector")),i=t("./vector3");e.exports=function(){"use strict";var t={computeLineIntersection:function(t,e,o,r){var i=(r.x-o.x)*(t.y-o.y)-(r.y-o.y)*(t.x-o.x),s=(r.y-o.y)*(e.x-t.x)-(r.x-o.x)*(e.y-t.y),n=(e.x-t.x)*(t.y-o.y)-(e.y-t.y)*(t.x-o.x),h=(r.y-o.y)*(e.x-t.x)-(r.x-o.x)*(e.y-t.y),u=i/s,a=n/h;return{ua:u,ub:a}},computePlaneIntersection:function(t,e,o){var r=t.getNormal(),s=e.getNormal(),n=o.getNormal(),h=s.cross(n).multiply(t.d),u=n.cross(r).multiply(e.d),a=r.cross(s).multiply(o.d),l=1/i.dot(r,i.cross(s,n)),c=h.plus(u).plus(a).multiply(l);if(isNaN(c.x)||NaN==isNaN(c.y)||NaN==isNaN(c.z)){var f=new Error("failed to compute 3-plane intersection");console.log(f.stack())}return c},computeMeshAngles:function(t){for(var e=[],o=0;o<t.faces.length;o++)for(var i=t.faces[o],s=[i.v1.pos,i.v2.pos,i.v3.pos],n=0;3>n;n++){var h=s[(n+1)%3].minus(s[n]).normalize(),u=s[(n+2)%3].minus(s[n]).normalize(),a=Math.acos(r.dot(h,u));a*=180/Math.PI,e.push(a)}return e}};return t}()},{"./point":18,"./vector":21,"./vector3":22}],15:[function(t,e,o){t("./vertex");e.exports=function(){"use strict";var t=function(t){this.vertex=t,this.mate=null,this.cut=null,this.next=null};return t}()},{"./vertex":23}],16:[function(t,e,o){var r=t("./halfedge"),i=t("./triangle");t("./vertex");e.exports=function(){"use strict";var t=function(){this.verts=[],this.faces=[],this.halfEdges={}};return t.prototype.createFace=function(t,e,o,r){t&&e&&o||console.log("problem!");var s=new i(t,e,o,r);this.faces.push(s),void 0===t.id&&(t.id=this.verts.length,this.verts.push(t)),void 0===e.id&&(e.id=this.verts.length,this.verts.push(e)),void 0===o.id&&(o.id=this.verts.length,this.verts.push(o))},t.prototype.halfEdgeForVerts=function(t,e){var o=t.pos.toString()+"|"+e.pos.toString(),i=this.halfEdges[o];return i||(i=new r(e),t.halfEdges.push(i),this.halfEdges[o]=i),i},t.prototype.buildAdjacency=function(){for(var t=0;t<this.faces.length;t++){var e=this.faces[t].v1,o=this.faces[t].v2,r=this.faces[t].v3;this.faces[t].halfEdges[0]=this.halfEdgeForVerts(e,o),this.faces[t].halfEdges[1]=this.halfEdgeForVerts(o,r),this.faces[t].halfEdges[2]=this.halfEdgeForVerts(r,e);for(var i=0;3>i;i++)this.faces[t].halfEdges[i].face=this.faces[t];this.faces[t].halfEdges[0].mate=this.halfEdgeForVerts(o,e),this.faces[t].halfEdges[1].mate=this.halfEdgeForVerts(r,o),this.faces[t].halfEdges[2].mate=this.halfEdgeForVerts(e,r),this.faces[t].halfEdges[0].mate.mate=this.faces[t].halfEdges[0],this.faces[t].halfEdges[1].mate.mate=this.faces[t].halfEdges[1],this.faces[t].halfEdges[2].mate.mate=this.faces[t].halfEdges[2],this.faces[t].halfEdges[0].next=this.faces[t].halfEdges[1],this.faces[t].halfEdges[1].next=this.faces[t].halfEdges[2],this.faces[t].halfEdges[2].next=this.faces[t].halfEdges[0]}},t.prototype.getEdgesAroundVertex=function(t){return t.halfEdges},t.prototype.getFacesAroundVertex=function(t){return t.faces},t.prototype.getFacesAroundEdge=function(t){var e=[];if(t.face&&e.push(t.face),t.mate.face&&e.push(t.mate.face),0===e.length)throw new Error("Edge has no incident faces.");return e},t.prototype.getFaces=function(){return this.faces},t.prototype.getVerticesAroundFace=function(t){var e=[t.v1,t.v2,t.v3];return e},t.prototype.getEdgesAroundFace=function(t){var e=[t.halfEdges[0],t.halfEdges[1],t.halfEdges[2]];return e},t}()},{"./halfedge":15,"./triangle":20,"./vertex":23}],17:[function(t,e,o){var r=t("./vector3");e.exports=function(){"use strict";var t=function(t,e,o,r){this.a=t,this.b=e,this.c=o,this.d=r};return t.fromPoints=function(e,o,r){var i=o.minus(e).cross(r.minus(e)).normalize(),s=i.dot(e);return new t(i.x,i.y,i.z,s)},t.fromPointAndNormal=function(e,o){var r=-o.dot(e),i=new t(o.x,o.y,o.z,r);return i},t.prototype.getNormal=function(){return new r(this.a,this.b,this.c)},t}()},{"./vector3":22}],18:[function(t,e,o){var r=t("./vector");e.exports=function(){"use strict";var t=function(t,e){r.call(this,t,e)};return t.prototype=Object.create(r.prototype),t.prototype.constructor=t,t}()},{"./vector":21}],19:[function(t,e,o){var r=t("./point");e.exports=function(){"use strict";var t=function(t,e,o,r){this.left=t,this.bottom=e,this.right=o,this.top=r};return t.prototype.width=function(){return this.right-this.left},t.prototype.height=function(){return this.top-this.bottom},t.prototype.center=function(){return new r(.5*(this.left+this.right),.5*(this.top+this.bottom))},t.EMPTY=function(){return new t(0,0,0,0)},t.prototype.containsPoint=function(t){return t.x>=this.left&&t.y>=this.bottom&&t.x<=this.right&&t.y<=this.top},t.prototype.strictlyContainsPoint=function(t){},t.prototype.containsRect=function(t){},t.prototype.strictlyContainsRect=function(t){},t.prototype.intersects=function(t){},t}()},{"./point":18}],20:[function(t,e,o){e.exports=function(){"use strict";var t=function(t,e,o,r){this.v1=t,this.v2=e,this.v3=o,this.material=r,t.faces||(t.faces=[]),e.faces||(e.faces=[]),o.faces||(o.faces=[]),t.faces.push(this),e.faces.push(this),o.faces.push(this),this.halfEdges=[]};return t.prototype.toSVG=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","path"),e=" M "+this.v1.pos.x+" "+this.v1.pos.y+" L "+this.v2.pos.x+" "+this.v2.pos.y+" L "+this.v3.pos.x+" "+this.v3.pos.y+" L "+this.v1.pos.x+" "+this.v1.pos.y;t.setAttribute("d",e),t.setAttribute("stroke-width","0.2");var o="black",r="#FFFFFF";switch(this.material){case 0:r="#cad7f2",o="#a0b0b0";break;case 1:r="#fed8bc",o="#b0b0a0";break;case 2:r="#bbFFbb",o="#007700";break;case 3:r="#bbbbFF",o="#000077";break;default:r="#ffffff",o="black"}return t.setAttribute("fill",r),t.setAttribute("stroke",o),t},t}()},{}],21:[function(t,e,o){e.exports=function(){"use strict";var t=function(t,e){this.x=t,this.y=e};return t.prototype.toString=function(){return"["+this.x+", "+this.y+"]"},t.prototype.createPerpendicular=function(){return new t(this.y,-1*this.x)},t.prototype.plus=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.minus=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.dot=function(e){return t.dot(this,e)},t.prototype.cross=function(e){return t.cross(this,e)},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,this},t.normalize=function(t){return t.normalize()},t.min=function(e,o){return new t(e.x<o.x?e.x:o.x,e.y<o.y?e.y:o.y)},t.max=function(e,o){return new t(e.x>o.x?e.x:o.x,e.y>o.y?e.y:o.y)},t.angleBetween=function(t,e){},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.cross=function(t,e){return t.x*e.y-t.y*e.x},t.ZERO=function(){return new t(0,0)},t.UNIT_X=function(){return new t(1,0)},t.UNIT_Y=function(){return new t(0,1)},t}()},{}],22:[function(t,e,o){e.exports=function(){"use strict";var t=function(t,e,o){this.x=t,this.y=e,this.z=o};return t.prototype.toString=function(){return"["+this.x+", "+this.y+", "+this.z+"]"},t.prototype.plus=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.minus=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.dot=function(e){return t.dot(this,e)},t.prototype.cross=function(e){return t.cross(this,e)},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,this.z/=t,this},t.normalize=function(t){return t.normalize()},t.min=function(e,o){return new t(e.x<o.x?e.x:o.x,e.y<o.y?e.y:o.y,e.z<o.z?e.z:o.z)},t.max=function(e,o){return new t(e.x>o.x?e.x:o.x,e.y>o.y?e.y:o.y,e.z>o.z?e.z:o.z)},t.angleBetween=function(t,e){},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.cross=function(e,o){return new t(e.y*o.z-e.z*o.y,e.z*o.x-e.x*o.z,e.x*o.y-e.y*o.x)},t.ZERO=function(){return new t(0,0,0)},t.UNIT_X=function(){return new t(1,0,0)},t.UNIT_Y=function(){return new t(0,1,0)},t.UNIT_Z=function(){return new t(0,0,1)},t}()},{}],23:[function(t,e,o){var r=t("./vector");e.exports=function(){"use strict";var t=function(t){this.pos=t?t:r.ZERO(),this.halfEdges=[],this.faces=[],this.parent=null,this.order_=0};return t.prototype=Object.create(r.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return"["+this.pos.x+", "+this.pos.y+"]"},t.prototype.order=function(){return this.root().order_},t.prototype.root=function(){for(var t=this;t.parent;)t=t.parent;return t},t.CreateAt=function(e,o){return new t(new r(e,o))},t}()},{"./vector":21}],24:[function(t,e,o){var r=t("./geometry/vector"),i=t("./geometry/vector3");e.exports=function(){"use strict";var t=function(e,o,r,i,s,n,h,u,a){if(void 0==e)var l=[[1,0,0],[0,1,0],[0,0,1]];else var l=[[e,o,r],[i,s,n],[h,u,a]];var c=Object.create(Array.prototype);return c=Array.apply(c,l)||c,t.injectClassMethods_(c),c};return t.injectClassMethods_=function(e){for(var o in t.prototype)t.prototype.hasOwnProperty(o)&&(e[o]=t.prototype[o]);return e},t.prototype.toString=function(){for(var t="[",e=0;3>e;e++){t+="[";for(var o=0;3>o;o++)t+=this[e][o],2>o&&(t+=",");t+="]",2>e&&(t+=", ")}return t+="]"},t.prototype.multiply=function(e){for(var o=new t(0,0,0,0,0,0,0,0,0),r=0;3>r;r++)for(var i=0;3>i;i++)for(var s=0;3>s;s++)o[r][i]+=this[r][s]*e[s][i];return o},t.prototype.multiplyVector=function(t){var e=new i(t.x,t.y,1),o=this.multiplyVector3(e);return new r(o.x/o.z,o.y/o.z)},t.prototype.multiplyVector3=function(t){var e=new i;return e.x=this[0][0]*t.x+this[0][1]*t.y+this[0][2]*t.z,e.y=this[1][0]*t.x+this[1][1]*t.y+this[1][2]*t.z,e.z=this[2][0]*t.x+this[2][1]*t.y+this[2][2]*t.z,e},t.prototype.inverse=function(){var e=new t,o=+this[0][0]*(this[1][1]*this[2][2]-this[2][1]*this[1][2])-this[0][1]*(this[1][0]*this[2][2]-this[1][2]*this[2][0])+this[0][2]*(this[1][0]*this[2][1]-this[1][1]*this[2][0]),r=1/o;return e[0][0]=(this[1][1]*this[2][2]-this[2][1]*this[1][2])*r,e[0][1]=-(this[0][1]*this[2][2]-this[0][2]*this[2][1])*r,e[0][2]=(this[0][1]*this[1][2]-this[0][2]*this[1][1])*r,e[1][0]=-(this[1][0]*this[2][2]-this[1][2]*this[2][0])*r,e[1][1]=(this[0][0]*this[2][2]-this[0][2]*this[2][0])*r,e[1][2]=-(this[0][0]*this[1][2]-this[1][0]*this[0][2])*r,e[2][0]=(this[1][0]*this[2][1]-this[2][0]*this[1][1])*r,e[2][1]=-(this[0][0]*this[2][1]-this[2][0]*this[0][1])*r,e[2][2]=(this[0][0]*this[1][1]-this[1][0]*this[0][1])*r,e},t.createRotation=function(e){var o=new t;return o[0][0]=Math.cos(e),o[0][1]=-Math.sin(e),o[1][0]=Math.sin(e),o[1][1]=Math.cos(e),o},t.createTranslation=function(e,o){var r=new t;return r[0][2]=e,r[1][2]=o,r},t.createScale=function(e,o){var r=new t;return r[0][0]=e,r[1][1]=o,r},t}()},{"./geometry/vector":21,"./geometry/vector3":22}],25:[function(t,e,o){var r=t("./geometry/rect");e.exports=function(){"use strict";var t=function(t){this.bounds=t,this.level=null,this.parent=null,this.children=[]};return t.prototype.hasChildren=function(){return this.children.length>0},t.prototype.subdivide=function(){if(0==this.level)return!1;for(var t=0;4>t;t++){var e=.5*this.bounds.width(),o=.5*this.bounds.height(),i=this.bounds.left+((t&_01)>>0)*e,s=this.bounds.bottom+((t&_10)>>1)*o,n=new r(i,s,i+e,s+o),h=new Cell(n);h.level=this.level-1,h.xLocCode=this.xLocCode|(t&_01)>>0<<h.level,h.yLocCode=this.yLocCode|(t&_10)>>1<<h.level,h.parent=this,this.children.push(h)}return!0},t.prototype.toSVG=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x",this.bounds.left),t.setAttribute("y",this.bounds.bottom),t.setAttribute("height",this.bounds.width()),t.setAttribute("width",this.bounds.height()),t.setAttribute("fill","none"),t.setAttribute("stroke","#0000bb"),t.setAttribute("stroke-width","0.1");var e=this;return t.onclick=function(){window.setCurrentCell(e)},t},t.prototype.splitSVG=function(t){this.subdivide();for(var e=t.parentElement,o=0;o<this.children.length;o++)this.children[o]&&e.appendChild(this.children[o].toSVG())},t}()},{"./geometry/rect":19}],26:[function(t,e,o){var r=t("./geometry/rect"),i=t("./quadcell");e.exports=function(){"use strict";var t=function(t,e){e?this.maxLevels=e:this.maxLevels=l,this.bounds=t,this.nLevels=this.maxLevels+1,this.rootLevel=this.maxLevels,this.maxVal=pow2(this.rootLevel),this.maxCode=this.maxVal-1,this.root=new i(t),this.root.xLocCode=0,this.root.yLocCode=0,this.root.level=this.rootLevel};t.prototype.getRoot=function(){return this.root},t.prototype.getCell=function(t,e){if(0>t||0>e)return null;if(t>this.maxCode||e>this.maxCode)return null;for(var o=this.root,r=this.rootLevel-1;o&&o.level>0;){var i=1<<r,s=((t&i)>>r<<0)+((e&i)>>r<<1);--r;var n=o.children[s];if(void 0===n)return o;if(n.xLocCode==t&&n.yLocCode==e)return n;o=n}return o},t.prototype.getNeighbor=function(t,e){var o=1<<t.level,r=t.xLocCode+u[e][0]*o,i=t.yLocCode+u[e][1]*o;return this.getCell(r,i)},t.prototype.getNeighborAtLevel=function(t,e,o,r){var i=1<<t.level,s=t.xLocCode+u[e][0]*i,n=t.yLocCode+u[e][1]*i;if(0>s||0>n)return null;if(s>=this.maxCode||n>=this.maxCode)return null;for(var t=this.getRoot(),h=t.level-1;t&&t.level>o;){var a=1<<h,l=((s&a)>>h)+((n&a)>>h<<1);if(--h,t.hasChildren())t=t.children[l];else{if(r)break;t=null}}return t},t.prototype.addCellAtDepth=function(t,e,o){for(var r,i,s=Math.round(t-.5),n=Math.round(e-.5),h=this.root,u=this.rootLevel-1,a=u+1;a--&&h.level>0;)r=1<<u,i=((s&r)>>u)+((n&r)>>u<<1),--u,h.hasChildren()||(console.log("subdividing"),h.subdivide()),h=h.children[i];return h},t.prototype.balance=function(){var t=[],e=[];for(t.push(this.root);t.length>0;){var o=t.shift();if(0===o.xLocCode&&24===o.yLocCode&&console.log("examining target cell"),o.hasChildren())for(var r=0;4>r;r++)t.push(o.children[r]);else 0===o.xLocCode&&24===o.yLocCode&&console.log("pushing target cell onto stack at "+e.length),e.push(o)}for(;e.length>0;){var o=e.pop();0===o.xLocCode&&24===o.yLocCode&&console.log("at the problem cell");for(var r=0;4>r;r++){var i=this.getNeighborAtLevel(o,r,o.level);if(i&&i.hasChildren()){var s=[i.children[a[r][0]],i.children[a[r][1]]];if(s[0].hasChildren()||s[1].hasChildren()){o.subdivide();break}}}if(o.hasChildren())for(var r=0;4>r;r++)e.push(o.children[r])}},t.prototype.toSVG=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","g"),e=[];for(e.push(this.root);e.length>0;){var o=e.shift();t.appendChild(o.toSVG());for(var r=0;r<o.children.length;r++)o.children[r]&&e.push(o.children[r])}return t};var e=function(t,e,o){for(var r=0,i=t[r].valueAt(e,o),s=0;s<t.length;s++){var n=t[s].valueAt(e,o);n>i&&(i=n,r=s)}return r};t.createFromCSGFields=function(o,i){if(!o||o.length<1)throw new Error("Must provide at least two input fields");for(var s=o[0].getBounds(),n=new t(s,i),h=0;h<s.height();h++)for(var u=0;u<s.width();u++){var a=new r(u,h,u+1,h+1),l=e(o,a.left,a.bottom),c=e(o,a.left+1,a.bottom),f=e(o,a.left+1,a.bottom+1),p=e(o,a.left,a.bottom+1);if(l!=c||c!=f||f!=p||p!=l||p!=c||l!=f){var d=a.left/s.width()*n.maxVal,v=a.bottom/s.height()*n.maxVal;n.addCellAtDepth(d,v,i)}}return n},t.createFromFloatFields=function(o){if(!o||o.length<1)throw new Error("Must provide at least two input fields");for(var i=o[0].getBounds(),s=0,n=0;s<Math.max(i.width(),i.height());)s=pow2(++n);console.log("requires no more than "+n+" levels to achieve "+s+" res");for(var h=new t(i,n),u=0;u<i.height();u++)for(var a=0;a<i.width();a++){var l=new r(a,u,a+1,u+1),c=e(o,l.left,l.bottom),f=e(o,l.left+1,l.bottom),p=e(o,l.left+1,l.bottom+1),d=e(o,l.left,l.bottom+1);(c!=f||f!=p||p!=d||d!=c||d!=f||c!=p)&&(console.log("adding cell at ("+a+", "+u+")"),h.addCellAtDepth(l.left,l.bottom,n))}return h},t.createFromSizingField=function(e){var o=new t(e.getBounds()),r=[];for(r.push(o.getRoot());r.length>0;){var i=r.shift(),s=i.bounds.left+.5*i.bounds.width(),n=i.bounds.bottom+.5*i.bounds.height();if(i.bounds.size.x>.5*e.valueAt(s,n)&&i.subdivide())for(var h=0;4>h;h++)r.push(i.children[h])}return o};var o=0,s=1,n=2,h=3,u=[[-1,0],[1,0],[0,-1],[0,1]],a=[[s,h],[o,n],[n,h],[o,s]],l=8;return t}()},{"./geometry/rect":19,"./quadcell":25}],27:[function(t,e,o){var r=(t("./quadtree"),t("./geometry/triangle"),t("./geometry/vertex")),i=t("./geometry/vector"),s=t("./geometry/mesh");e.exports=function(){"use strict";var t=[[3,0],[1,2],[0,1],[2,3]],e=function(t){this.tree=t,this.vertexMap={}};return e.prototype.vertexForPosition_=function(t,e){var o=this.vertexMap[t.toString()];return void 0!==o||e||(o=new r(t),this.vertexMap[t.toString()]=o),o},e.prototype.createVertices_=function(){var t=[];for(t.push(tree.getRoot());t.length>0;){var e=t.shift();if(e.hasChildren())for(var o=0;4>o;o++)t.push(e.children[o]);else{e.bounds;this.vertexForPosition_(new i(e.bounds.left,e.bounds.bottom)),this.vertexForPosition_(new i(e.bounds.left+e.bounds.width(),e.bounds.bottom)),this.vertexForPosition_(new i(e.bounds.left+e.bounds.width(),e.bounds.bottom+e.bounds.height())),this.vertexForPosition_(new i(e.bounds.left,e.bounds.bottom+e.bounds.height())),this.vertexForPosition_(new i(e.bounds.left+.5*e.bounds.width(),e.bounds.bottom+.5*e.bounds.height()))}}},e.prototype.createTriangles_=function(){var e=[];for(e.push(tree.getRoot());e.length>0;){var o=e.shift();if(o.hasChildren())for(var r=0;4>r;r++)e.push(o.children[r]);else{var s=(o.bounds,[]);s.push(this.vertexForPosition_(new i(o.bounds.left,o.bounds.bottom))),s.push(this.vertexForPosition_(new i(o.bounds.left+o.bounds.width(),o.bounds.bottom))),s.push(this.vertexForPosition_(new i(o.bounds.left+o.bounds.width(),o.bounds.bottom+o.bounds.height()))),s.push(this.vertexForPosition_(new i(o.bounds.left,o.bounds.bottom+o.bounds.height())));
for(var n=this.vertexForPosition_(new i(o.bounds.left+.5*o.bounds.width(),o.bounds.bottom+.5*o.bounds.height())),h=[],u=0;4>u;u++)h[u]=this.tree.getNeighborAtLevel(o,u,o.level);for(var u=0;4>u;u++){var a=this.vertexForPosition_(new i(.5*(s[t[u][0]].pos.x+s[t[u][1]].pos.x),.5*(s[t[u][0]].pos.y+s[t[u][1]].pos.y)),!0);a?(this.mesh.createFace(s[t[u][0]],a,n,3),this.mesh.createFace(s[t[u][1]],a,n,3)):this.mesh.createFace(s[t[u][0]],s[t[u][1]],n,1)}}}},e.prototype.setQuadTree=function(t){this.tree=t},e.prototype.createMesh=function(){if(!this.tree)throw new Error("no quad tree provided");this.mesh=new s;var t=[];for(t.push(tree.getRoot());t.length>0;){var e=t.shift();if(e.hasChildren())for(var o=0;4>o;o++)t.push(e.children[o]);else this.meshCell_(e)}return this.mesh},e.prototype.meshCell_=function(e){var o=(e.bounds,[]);o.push(this.vertexForPosition_(new i(e.bounds.left,e.bounds.bottom))),o.push(this.vertexForPosition_(new i(e.bounds.left+e.bounds.width(),e.bounds.bottom))),o.push(this.vertexForPosition_(new i(e.bounds.left+e.bounds.width(),e.bounds.bottom+e.bounds.height()))),o.push(this.vertexForPosition_(new i(e.bounds.left,e.bounds.bottom+e.bounds.height())));for(var r=this.vertexForPosition_(new i(e.bounds.left+.5*e.bounds.width(),e.bounds.bottom+.5*e.bounds.height())),s=[],n=0;4>n;n++)if(s[n]=this.tree.getNeighborAtLevel(e,n,e.level,!0),null==s[n])this.mesh.createFace(o[t[n][0]],o[t[n][1]],r,1);else if(s[n].level!==e.level||s[n].hasChildren()){if(s[n].level===e.level+1)this.mesh.createFace(o[t[n][0]],o[t[n][1]],r,2);else if(s[n].level===e.level&&s[n].hasChildren()){var h=this.vertexForPosition_(new i(.5*(o[t[n][0]].pos.x+o[t[n][1]].pos.x),.5*(o[t[n][0]].pos.y+o[t[n][1]].pos.y)));this.mesh.createFace(o[t[n][0]],h,r,3),this.mesh.createFace(o[t[n][1]],r,h,3)}}else this.mesh.createFace(o[t[n][0]],o[t[n][1]],r,2)},e}()},{"./geometry/mesh":16,"./geometry/triangle":20,"./geometry/vector":21,"./geometry/vertex":23,"./quadtree":26}]},{},[1]);